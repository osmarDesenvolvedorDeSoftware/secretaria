[supervisord]
logfile=logs/supervisord.log
pidfile=/tmp/supervisord.pid
childlogdir=logs
nodaemon=false

[program:rq-worker-default]
command=python -m app.workers.rq_worker --queue default
process_name=%(program_name)s_%(process_num)02d
numprocs=2
autostart=true
autorestart=true
startsecs=5
stopsignal=TERM
stopwaitsecs=20
stdout_logfile=logs/rq-default_%(process_num)02d.log
stderr_logfile=logs/rq-default_%(process_num)02d.err.log
environment=REDIS_URL=%(ENV_REDIS_URL)s

[program:rq-worker-priority]
command=python -m app.workers.rq_worker --queue priority --queue default
process_name=%(program_name)s_%(process_num)02d
numprocs=1
autostart=true
autorestart=true
startsecs=5
stdout_logfile=logs/rq-priority_%(process_num)02d.log
stderr_logfile=logs/rq-priority_%(process_num)02d.err.log
environment=REDIS_URL=%(ENV_REDIS_URL)s

[program:rq-monitor]
command=/bin/sh -c 'while true; do rq info --url ${REDIS_URL:-redis://redis:6379/0} || exit 1; sleep 30; done'
autostart=true
autorestart=true
startsecs=5
stdout_logfile=logs/rq-monitor.log
stderr_logfile=logs/rq-monitor.err.log
environment=REDIS_URL=%(ENV_REDIS_URL)s

[group:rq-workers]
programs=rq-worker-default,rq-worker-priority,rq-monitor
priority=999
